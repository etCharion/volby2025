<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Školní Volební Kalkulačka a Vizualizace</title>
    <!-- Bulma CSS Framework pro moderní vzhled a responsivitu -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <!-- React a ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel CDN pro JSX kompilaci v prohlížeči -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Chart.js pro grafy -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        /* CSS pro estetiku, zejména pro tečkový graf mandátů */
        .mandate-dot {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin: 2px;
            vertical-align: middle;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: default;
        }
        .mandate-dot:hover {
            transform: scale(1.4);
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
        }
        .explanation-modal-content {
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }
        /* Zvýraznění posledního mandátu v tabulce vysvětlení */
        .highlight-row {
            background-color: #ffb7001a; /* Světle oranžová pro zvýraznění */
            font-weight: bold;
        }
        .highlight-cell {
             background-color: #ffb70033;
        }
        .app-container {
            min-height: 100vh;
            background-color: #f7f7fa;
        }
        .box {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(10, 10, 10, 0.1);
        }
        .info-tag {
            background-color: #48c78e;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        // Vstupní data extrahovaná z CSV souboru "volby 2025 - List 1.csv"
        const RAW_DATA = [
            { Strana: "Spolu", Studenti_Ostatni: 26, Studenti_Ctvrtaci: 3, Ucitele: 4 },
            { Strana: "SPD", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Motoristé", Studenti_Ostatni: 5, Studenti_Ctvrtaci: 2, Ucitele: 1 },
            { Strana: "MZH", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Generace", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Levice", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "SMS", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 1, Ucitele: 0 },
            { Strana: "Přísaha", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Voluntia", Studenti_Ostatni: 3, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Ano", Studenti_Ostatni: 2, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Rebelové", Studenti_Ostatni: 3, Studenti_Ctvrtaci: 0, Ucitele: 0 },
            { Strana: "Koruna", Studenti_Ostatni: 1, Studenti_Ctvrtaci: 0, Ucitele: 1 },
            { Strana: "STAN", Studenti_Ostatni: 35, Studenti_Ctvrtaci: 9, Ucitele: 4 },
            { Strana: "Piráti", Studenti_Ostatni: 24, Studenti_Ctvrtaci: 3, Ucitele: 1 },
        ];

        // Celková účast a maximální počty (ze souboru)
        const TOTALS = {
            Studenti_Hlasovali: 123,
            Studenti_Max: 182,
            Ucitele_Hlasovali: 11,
            Ucitele_Max: 24,
            Ctvrtaci_Hlasovali: 18,
            Celkem_Max: 206
        };

        // Barvy pro strany (pro vizuální konzistenci)
        const PARTY_COLORS = {
            "STAN": "#00bcd4",   // Tyrkysová
            "Spolu": "#007bff",  // Modrá (ODS/TOP/KDU)
            "Piráti": "#ff9800", // Oranžová tmavá
            "Motoristé": "#ffc107", // Žlutá
            "Koruna": "#9966ff", // Fialová
            "Voluntia": "#6c757d", // Šedá
            "Ano": "#20c997", // Světle zelená
            "Rebelové": "#ff6384", // Korálová
            "SMS": "#e83e8c", // Růžová
            "SPD": "#dc3545", // Červená
            "MZH": "#28a745", // Zelená
            "Generace": "#6f42c1", // Tmavě fialová
            "Levice": "#fd7e14", // Oranžová
            "Přísaha": "#17a2b8", // Azurová
            "Ostatní": "#495057" // Pro zbývající strany
        };
        
        // --- Volební Kalkulačka ---

        const MANDATES_COUNT = 200;
        // Násobení reálných hlasů koeficientem, abychom mohli spravedlivě rozdělit 200 mandátů
        const SIMULATION_MULTIPLIER = 1000;
        const QUORUM_PERCENT = 0.05; // 5%

        function calculateMandates(data, totalValidVotes) {
            // 1. Nastavení prahu
            const totalSimulatedVotes = totalValidVotes * SIMULATION_MULTIPLIER;
            const quorumVotes = totalSimulatedVotes * QUORUM_PERCENT;

            // 2. Filtrování stran, které překročily kvórum
            let qualifiedParties = data
                .map(p => ({
                    ...p,
                    simulatedVotes: p.votes * SIMULATION_MULTIPLIER
                }))
                .filter(p => p.simulatedVotes >= quorumVotes);

            // 3. Spočítání mandátů D'Hondtovou metodou
            let mandates = qualifiedParties.map(p => ({
                Strana: p.Strana,
                simulatedVotes: p.simulatedVotes,
                totalVotes: p.votes,
                quorumReached: true,
                mandates: 0,
                // Data pro tabulku vysvětlení
                divisors: [1],
                quotients: [p.simulatedVotes], 
            }));

            // Alokátor pro iterativní výpočet
            let allocator = mandates.map(p => ({
                Strana: p.Strana,
                simulatedVotes: p.simulatedVotes,
                quotient: p.simulatedVotes,
                mandates: 0,
            }));

            let lastMandateQuotient = 0; // Kvocient, který zajistil poslední mandát
            let lastMandateWinner = null;

            // Rozdělení 200 mandátů
            for (let i = 0; i < MANDATES_COUNT; i++) {
                // Najdi stranu s nejvyšším kvocientem
                allocator.sort((a, b) => b.quotient - a.quotient);

                if (allocator.length > 0) {
                    const winner = allocator[0];
                    winner.mandates++;
                    
                    // Uložení detailů o posledním mandátu
                    if (i === MANDATES_COUNT - 1) {
                         lastMandateQuotient = winner.quotient;
                         lastMandateWinner = winner.Strana;
                    }
                    
                    // Aktualizuj kvocient (D'Hondt: hlasy / (počet mandátů + 1))
                    winner.quotient = winner.simulatedVotes / (winner.mandates + 1);

                    // Aktualizace hlavního pole pro výsledky a tabulku vysvětlení
                    const originalParty = mandates.find(p => p.Strana === winner.Strana);
                    if (originalParty) {
                        originalParty.divisors.push(winner.mandates + 1);
                        originalParty.quotients.push(winner.quotient);
                    }
                }
            }
            
            // 4. Seřazení a přidání stran, které neprošly kvórem
            const unqualifiedParties = data
                .filter(p => (p.votes * SIMULATION_MULTIPLIER) < quorumVotes)
                .map(p => ({
                    Strana: p.Strana,
                    simulatedVotes: p.votes * SIMULATION_MULTIPLIER,
                    totalVotes: p.votes,
                    quorumReached: false,
                    mandates: 0,
                    divisors: [1],
                    quotients: [p.votes * SIMULATION_MULTIPLIER],
                }));

            const finalResults = [...mandates, ...unqualifiedParties].sort((a, b) => b.simulatedVotes - a.simulatedVotes);
            const totalAllocatedMandates = finalResults.reduce((sum, p) => sum + p.mandates, 0);

            return {
                results: finalResults,
                totalAllocatedMandates: totalAllocatedMandates,
                multiplier: SIMULATION_MULTIPLIER,
                quorumPercent: QUORUM_PERCENT,
                quorumVotes: Math.ceil(quorumVotes), 
                lastMandateQuotient,
                lastMandateWinner,
            };
        }

        // --- Komponenty pro vizualizaci ---

        // Vizuální vysvětlení volebního přepočtu
        function ExplanationModal({ isVisible, onClose, calculationData }) {
            if (!isVisible || !calculationData) return null;

            const { results, multiplier, quorumVotes, lastMandateQuotient, lastMandateWinner, totalAllocatedMandates, totalValidVotes } = calculationData;
            
            const qualifiedResults = results.filter(p => p.quorumReached);
            const unqualifiedResults = results.filter(p => !p.quorumReached);
            const totalSimulatedVotes = qualifiedResults.reduce((sum, p) => sum + p.simulatedVotes, 0);

            return (
                <div className={`modal ${isVisible ? 'is-active' : ''}`}>
                    <div className="modal-background" onClick={onClose}></div>
                    <div className="modal-card is-large">
                        <header className="modal-card-head">
                            <p className="modal-card-title">Vysvětlení přepočtu hlasů (D'Hondtova metoda)</p>
                            <button className="delete" aria-label="close" onClick={onClose}></button>
                        </header>
                        <section className="modal-card-body explanation-modal-content">
                            <h3 className="title is-4">1. Volební kvórum (5 %)</h3>
                            <p>
                                Pro rozdělení **200 mandátů** je nutné překročit **5% práh** platných hlasů.
                                Vzhledem k malému počtu reálných hlasů ({totalValidVotes}) jsme použili **simulační koeficient $\times {multiplier}$**.
                            </p>
                            <ul>
                                <li>Celkový počet simulačních hlasů: **{totalSimulatedVotes.toLocaleString('cs')}**</li>
                                <li>Kvórum (5 %): **{quorumVotes.toLocaleString('cs')}** simulačních hlasů.</li>
                            </ul>
                            
                            <hr />
                            
                            <h3 className="title is-4">2. D'Hondtova metoda (Největší zbytky)</h3>
                            <p>Mandáty se dělí postupně, dokud není rozděleno všech **{totalAllocatedMandates}** mandátů. V každém kroku získá mandát strana s **nejvyšším kvocientem**.</p>
                            <p><strong>Vzorec pro výpočet kvocientu:</strong></p>
                            <p className="has-text-centered title is-3">
                                $$\text{Kvocient} = \frac{\text{Hlasy}}{\text{M} + 1}$$
                            </p>
                            <p className="mt-4">kde $Hlasy$ jsou simulační hlasy strany, a $M$ je dosavadní počet získaných mandátů.</p>

                            <h4 className="title is-5 mt-4">Ukázka výpočtu (prvních 5 kol dělení)</h4>
                            <div className="table-container">
                                <table className="table is-bordered is-striped is-narrow is-hoverable is-fullwidth">
                                    <thead>
                                        <tr>
                                            <th>Strana</th>
                                            <th>Simul. Hlasy (M=0)</th>
                                            <th>1. Mandát (M=1)</th>
                                            <th>2. Mandát (M=2)</th>
                                            <th>3. Mandát (M=3)</th>
                                            <th>4. Mandát (M=4)</th>
                                            <th>...</th>
                                            <th>Celkem Mandátů</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {qualifiedResults.map(p => {
                                            const quotients = p.quotients;
                                            return (
                                                <tr key={p.Strana} className={p.Strana === lastMandateWinner ? 'highlight-row' : ''}>
                                                    <th>{p.Strana}</th>
                                                    {/* Kvocienty pro 1, 2, 3, 4, 5. mandát (dělení 1 až 5) */}
                                                    {Array.from({ length: 5 }, (_, i) => {
                                                        const quotient = quotients[i];
                                                        return <td key={i} className="has-text-right">{quotient.toLocaleString('cs', { maximumFractionDigits: 0 })}</td>;
                                                    })}
                                                    <td>...</td>
                                                    <td><strong>{p.mandates}</strong></td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>

                            <p className="has-text-info mt-4">
                                Poslední, **200. mandát**, připadl straně **{lastMandateWinner || 'N/A'}** s kvocientem přibližně **{lastMandateQuotient.toLocaleString('cs', { maximumFractionDigits: 0 }) || 'N/A'}**.
                            </p>

                            <hr />

                            <h3 className="title is-4">3. Strany, které nezískaly mandát</h3>
                            <div className="content">
                                <ul>
                                    {unqualifiedResults.map(p => (
                                        <li key={p.Strana}>Strana **{p.Strana}** získala {p.totalVotes} reálných hlasů, což znamenalo pouhých **{((p.totalVotes / totalValidVotes) * 100).toFixed(2)} %**. (Potřebné minimum: 5.00 %).</li>
                                    ))}
                                </ul>
                            </div>
                        </section>
                        <footer className="modal-card-foot">
                            <button className="button is-link" onClick={onClose}>Rozumím, zavřít</button>
                        </footer>
                    </div>
                </div>
            );
        }

        // Kruhový graf (hlasy) nebo Sloupcový graf (hlasy/mandáty)
        function ChartComponent({ type, labels, data, colors, title }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);

            React.useEffect(() => {
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: type, 
                    data: {
                        labels: labels,
                        datasets: [{
                            label: title,
                            data: data,
                            backgroundColor: colors,
                            borderColor: '#fff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            title: {
                                display: true,
                                text: title,
                                font: { size: 18 }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const value = context.parsed;
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            label += `${value} (${percentage}%)`;
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: type === 'bar' ? {
                            y: {
                                beginAtZero: true
                            }
                        } : {}
                    }
                });

                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [type, labels, data, colors, title]);

            return <div style={{ height: '400px' }}><canvas ref={chartRef}></canvas></div>;
        }

        // Tečkový graf (mandáty)
        function DotMandateVisualization({ results }) {
            return (
                <div className="box is-fullheight">
                    <h4 className="title is-4 has-text-centered">Rozdělení Mandátů (200 křesel)</h4>
                    <p className="subtitle is-6 has-text-centered has-text-grey">Každá tečka představuje jeden mandát.</p>
                    <div className="content has-text-centered pt-4">
                        {results.filter(p => p.mandates > 0).map(p => (
                            <React.Fragment key={p.Strana}>
                                {Array(p.mandates).fill(0).map((_, i) => (
                                    <span 
                                        key={`${p.Strana}-${i}`} 
                                        className="mandate-dot" 
                                        style={{ backgroundColor: PARTY_COLORS[p.Strana] || PARTY_COLORS["Ostatní"] }}
                                        title={`${p.Strana}: Mandát ${i + 1} z ${p.mandates}`}
                                    ></span>
                                ))}
                            </React.Fragment>
                        ))}
                        {results.filter(p => p.mandates === 0).length > 0 && (
                            <p className="has-text-danger mt-5">
                                Strany bez mandátu (nepřekročily 5 % kvórum): 
                                <strong> {results.filter(p => p.mandates === 0).map(p => p.Strana).join(', ')}</strong>
                            </p>
                        )}
                    </div>
                </div>
            );
        }

        // Tabulka výsledků
        function ResultsTable({ data, totalVotes, totalMandates }) {
            return (
                <div className="table-container">
                    <table className="table is-bordered is-striped is-narrow is-hoverable is-fullwidth">
                        <thead>
                            <tr>
                                <th>Strana</th>
                                <th className="has-text-right">Hlasy</th>
                                <th className="has-text-right">Podíl (%)</th>
                                <th className="has-text-right">Mandáty</th>
                                <th>Kvórum (5 %)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {data.map(p => {
                                const percentage = totalVotes > 0 ? ((p.votes / totalVotes) * 100).toFixed(2) : 0;
                                return (
                                    <tr key={p.Strana}>
                                        <th style={{ backgroundColor: PARTY_COLORS[p.Strana] || PARTY_COLORS["Ostatní"], color: '#fff' }}>{p.Strana}</th>
                                        <td className="has-text-right">{p.votes}</td>
                                        <td className="has-text-right"><strong>{percentage}%</strong></td>
                                        <td className="has-text-right">
                                            <span className={`tag is-large ${p.mandates > 0 ? 'is-success' : 'is-light'}`}>
                                                {p.mandates}
                                            </span>
                                        </td>
                                        <td>
                                            {p.quorumReached
                                                ? <span className="tag is-success is-light">SPLNĚNO</span>
                                                : <span className="tag is-danger is-light">NESPLNĚNO</span>
                                            }
                                        </td>
                                    </tr>
                                );
                            })}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th>CELKEM</th>
                                <th className="has-text-right"><strong>{totalVotes}</strong></th>
                                <th className="has-text-right"><strong>100.00%</strong></th>
                                <th className="has-text-right"><strong>{totalMandates}</strong></th>
                                <th></th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            );
        }

        // Hlavní aplikace
        function SchoolElectionApp() {
            const [includeTeachers, setIncludeTeachers] = React.useState(false); 
            const [viewMode, setViewMode] = React.useState('pie_dots'); 
            const [isExplanationModalOpen, setIsExplanationModalOpen] = React.useState(false);

            // Zpracování dat a přepočet mandátů (memoizované pro efektivitu)
            const electionData = React.useMemo(() => {
                const totalValidVotes = RAW_DATA.reduce((sum, p) => {
                    const studentVotes = p.Studenti_Ostatni + p.Studenti_Ctvrtaci;
                    return sum + studentVotes + (includeTeachers ? p.Ucitele : 0);
                }, 0);

                const processedData = RAW_DATA.map(p => ({
                    Strana: p.Strana,
                    votes: (p.Studenti_Ostatni + p.Studenti_Ctvrtaci) + (includeTeachers ? p.Ucitele : 0),
                    ctvrtaciVotes: p.Studenti_Ctvrtaci,
                }));

                const mandateCalculation = calculateMandates(processedData, totalValidVotes);

                const finalData = processedData.map(p => ({
                    ...p,
                    mandates: mandateCalculation.results.find(m => m.Strana === p.Strana)?.mandates || 0,
                    quorumReached: mandateCalculation.results.find(m => m.Strana === p.Strana)?.quorumReached || false,
                }));
                
                return {
                    data: finalData.sort((a, b) => b.votes - a.votes),
                    totalVotes: totalValidVotes,
                    totalMandates: mandateCalculation.totalAllocatedMandates,
                    mandateCalculation: mandateCalculation,
                };
            }, [includeTeachers]);

            // Data pro vizualizace
            const chartLabels = electionData.data.map(p => p.Strana);
            const voteData = electionData.data.map(p => p.votes);
            const mandateData = electionData.data.map(p => p.mandates);
            const chartColors = electionData.data.map(p => PARTY_COLORS[p.Strana] || PARTY_COLORS["Ostatní"]);

            // Výpočet volební účasti
            const totalMaxVoters = TOTALS.Studenti_Max + (includeTeachers ? TOTALS.Ucitele_Max : 0);
            const totalVoted = electionData.totalVotes;
            const participationRate = totalMaxVoters > 0 ? ((totalVoted / totalMaxVoters) * 100).toFixed(1) : 0;
            const ctvrtaciVoted = TOTALS.Ctvrtaci_Hlasovali;

            return (
                <div className="app-container section">
                    <div className="container">
                        <h1 className="title is-2 has-text-centered mb-5">
                            <span className="icon-text">
                                <span className="icon is-large"><i className="fas fa-vote-yea"></i></span>
                                <span>Školní Volební Simulátor</span>
                            </span>
                        </h1>

                        {/* Ovládací panel a účast */}
                        <div className="box mb-5">
                            <div className="columns is-vcentered is-desktop">
                                {/* Volební účast */}
                                <div className="column is-one-third">
                                    <h3 className="title is-5 has-text-link">Volební Účast</h3>
                                    <div className="info-tag is-large">
                                        {totalVoted} z {totalMaxVoters} = **{participationRate}%**
                                    </div>
                                    <p className="has-text-grey is-size-7 mt-2">
                                        (*Hlasy čtvrťáků ({ctvrtaciVoted}) jsou označeny jako "korespondenční volba ze zahraničí".)
                                    </p>
                                </div>

                                {/* Přepínač voličů */}
                                <div className="column is-one-third has-text-centered">
                                    <h3 className="title is-5">Voliči</h3>
                                    <div className="field is-grouped is-grouped-centered">
                                        <div className="control">
                                            <button
                                                className={`button is-medium ${!includeTeachers ? 'is-info' : 'is-light'}`}
                                                onClick={() => setIncludeTeachers(false)}
                                            >
                                                Studenti
                                            </button>
                                        </div>
                                        <div className="control">
                                            <button
                                                className={`button is-medium ${includeTeachers ? 'is-info' : 'is-light'}`}
                                                onClick={() => setIncludeTeachers(true)}
                                            >
                                                Studenti + Učitelé
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Tlačítko pro vysvětlení */}
                                <div className="column is-one-third has-text-right-desktop has-text-centered-touch">
                                    <button 
                                        className="button is-warning is-medium is-light"
                                        onClick={() => setIsExplanationModalOpen(true)}
                                    >
                                        <span className="icon"><i className="fas fa-calculator"></i></span>
                                        <span>Jak se počítají mandáty?</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Přepínání zobrazení */}
                        <div className="box mb-5">
                            <h3 className="title is-5 has-text-centered mb-4">Vyberte si způsob vizualizace</h3>
                            <div className="tabs is-boxed is-fullwidth is-medium">
                                <ul>
                                    <li className={viewMode === 'pie_dots' ? 'is-active' : ''}>
                                        <a onClick={() => setViewMode('pie_dots')}>
                                            <span className="icon"><i className="fas fa-chart-pie"></i></span>
                                            <span>Koláč (Hlasy) &amp; Tečky (Mandáty)</span>
                                        </a>
                                    </li>
                                    <li className={viewMode === 'bar_votes' ? 'is-active' : ''}>
                                        <a onClick={() => setViewMode('bar_votes')}>
                                            <span className="icon"><i className="fas fa-chart-bar"></i></span>
                                            <span>Sloupcový graf (Hlasy)</span>
                                        </a>
                                    </li>
                                    <li className={viewMode === 'bar_mandates' ? 'is-active' : ''}>
                                        <a onClick={() => setViewMode('bar_mandates')}>
                                            <span className="icon"><i className="fas fa-th-list"></i></span>
                                            <span>Sloupcový graf (Mandáty)</span>
                                        </a>
                                    </li>
                                    <li className={viewMode === 'table' ? 'is-active' : ''}>
                                        <a onClick={() => setViewMode('table')}>
                                            <span className="icon"><i className="fas fa-table"></i></span>
                                            <span>Tabulka výsledků</span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        {/* Zobrazovací plocha */}
                        <div className="columns is-multiline is-centered">
                            {/* Standardní zobrazení: Koláč + Tečky */}
                            {(viewMode === 'pie_dots') && (
                                <>
                                    <div className="column is-12-touch is-6-desktop">
                                        <div className="box is-fullheight">
                                            <ChartComponent
                                                type="pie"
                                                labels={chartLabels}
                                                data={voteData}
                                                colors={chartColors}
                                                title="Podíl Hlasů (%)"
                                            />
                                        </div>
                                    </div>
                                    <div className="column is-12-touch is-6-desktop">
                                        <DotMandateVisualization results={electionData.data} />
                                    </div>
                                </>
                            )}
                            {/* Sloupcový graf - Hlasy */}
                            {viewMode === 'bar_votes' && (
                                <div className="column is-12">
                                    <div className="box">
                                        <ChartComponent
                                            type="bar"
                                            labels={chartLabels}
                                            data={voteData}
                                            colors={chartColors}
                                            title={`Počet Hlasů (Celkem: ${totalVoted})`}
                                        />
                                    </div>
                                </div>
                            )}
                            {/* Sloupcový graf - Mandáty */}
                            {viewMode === 'bar_mandates' && (
                                <div className="column is-12">
                                    <div className="box">
                                        <ChartComponent
                                            type="bar"
                                            labels={chartLabels}
                                            data={mandateData}
                                            colors={chartColors}
                                            title={`Počet Mandátů (Celkem: ${electionData.totalMandates})`}
                                        />
                                    </div>
                                </div>
                            )}
                            {/* Tabulka */}
                            {viewMode === 'table' && (
                                <div className="column is-12">
                                    <div className="box">
                                        <ResultsTable
                                            data={electionData.data}
                                            totalVotes={electionData.totalVotes}
                                            totalMandates={electionData.totalMandates}
                                        />
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* Modální okno s vysvětlením */}
                    <ExplanationModal
                        isVisible={isExplanationModalOpen}
                        onClose={() => setIsExplanationModalOpen(false)}
                        calculationData={electionData.mandateCalculation}
                        totalValidVotes={electionData.totalVotes}
                    />
                </div>
            );
        }

        // Font Awesome pro ikony
        const script = document.createElement('script');
        script.defer = true;
        script.src = "https://use.fontawesome.com/releases/v5.3.1/js/all.js";
        document.head.appendChild(script);

        // **DŮLEŽITÉ:** Spuštění renderování aplikace
        // Reaguje na událost DOMContentLoaded, aby se zajistilo, že element 'root' existuje.
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('root');
            if (container) {
                const root = ReactDOM.createRoot(container);
                root.render(<SchoolElectionApp />);
            }
        });

    </script>
</body>
</html>
