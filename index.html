<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Analýza Školních Voleb 2025</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f7f7f7; }
  </style>

  <!-- React + ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>

  <!-- PropTypes (fix pro Recharts UMD) -->
  <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js" crossorigin></script>

  <!-- Recharts + fallback -->
  <script
    src="https://cdn.jsdelivr.net/npm/recharts@2.12.7/umd/Recharts.min.js"
    crossorigin
    onerror="(function(){var s=document.createElement('script');s.src='https://unpkg.com/recharts@2.12.7/umd/Recharts.min.js';s.crossOrigin='anonymous';document.head.appendChild(s);})();"
  ></script>

  <!-- Babel (pro inline JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root" class="p-4 md:p-8"></div>

  <script type="text/babel">
    window.addEventListener('load', () => {
      const { useState, useMemo } = React;
      const R = window.Recharts;
      if (!R) throw new Error('Recharts CDN se nenačetl.');
      const { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = R;

      // --- DATA ---
      const initialData = [
        { name: 'Spolu', p13: 26, p4: 3, student: 29, teacher: 4, total: 33 },
        { name: 'SPD', p13: 1, p4: 0, student: 1, teacher: 0, total: 1 },
        { name: 'Motoristé', p13: 5, p4: 2, student: 7, teacher: 1, total: 8 },
        { name: 'MZH', p13: 1, p4: 0, student: 1, teacher: 0, total: 1 },
        { name: 'Generace', p13: 1, p4: 0, student: 1, teacher: 0, total: 1 },
        { name: 'Levice', p13: 1, p4: 0, student: 1, teacher: 0, total: 1 },
        { name: 'SMS', p13: 1, p4: 1, student: 2, teacher: 0, total: 2 },
        { name: 'Přísaha', p13: 1, p4: 0, student: 1, teacher: 0, total: 1 },
        { name: 'Voluntia', p13: 3, p4: 0, student: 3, teacher: 0, total: 3 },
        { name: 'Ano', p13: 2, p4: 0, student: 2, teacher: 0, total: 2 },
        { name: 'Rebelové', p13: 3, p4: 0, student: 3, teacher: 0, total: 3 },
        { name: 'Koruna', p13: 1, p4: 0, student: 1, teacher: 1, total: 2 },
        { name: 'STAN', p13: 35, p4: 9, student: 44, teacher: 4, total: 48 },
        { name: 'Piráti', p13: 24, p4: 3, student: 27, teacher: 1, total: 28 },
      ];

      const totalElectorate = { student: 182, teacher: 24, total: 206 };
      const votesCast        = { student: 123, teacher: 11, total: 134 };

      const PARTY_COLORS = {
        'STAN':'#2196F3','Piráti':'#FF9800','Spolu':'#4CAF50','Motoristé':'#F44336',
        'Koruna':'#FFEB3B','Ano':'#9C27B0','Rebelové':'#E91E63',
        'SPD':'#607D8B','MZH':'#795548','Generace':'#00BCD4','Levice':'#8BC34A',
        'SMS':'#CDDC39','Přísaha':'#FFC107','Voluntia':'#009688',
      };

      const mixWithWhite = (hex, amount=0.6) => {
        const h = hex.replace('#','');
        const bigint = parseInt(h.length===3 ? h.split('').map(c=>c+c).join('') : h, 16);
        let r = (bigint >> 16) & 255, g = (bigint >> 8) & 255, b = bigint & 255;
        r = Math.round(r*(1-amount) + 255*amount);
        g = Math.round(g*(1-amount) + 255*amount);
        b = Math.round(b*(1-amount) + 255*amount);
        return '#' + [r,g,b].map(v=>v.toString(16).padStart(2,'0')).join('');
      };

      // --- D'HONDT ---
      const calculateMandates = (data, totalVotes, totalMandates = 200, voteKey) => {
        const threshold = totalVotes * 0.05;
        const qualifying = data.filter(p => p[voteKey] >= threshold);

        if (!qualifying.length) {
          return data.map(p => ({
            ...p, votes: p[voteKey],
            percent: totalVotes ? (p[voteKey]/totalVotes)*100 : 0,
            mandates: 0, qualified: false,
            color: PARTY_COLORS[p.name] || '#9CA3AF'
          }));
        }

        const mandates = Object.create(null);
        const quotients = Object.create(null);
        for (const p of qualifying) { mandates[p.name]=0; quotients[p.name]=p[voteKey]; }

        for (let i=0;i<totalMandates;i++){
          let maxName=null, maxQ=-1;
          for (const name in quotients){ const q=quotients[name]; if(q>maxQ){maxQ=q;maxName=name;} }
          if(!maxName) break;
          mandates[maxName]++;
          const partyVotes = qualifying.find(p=>p.name===maxName)[voteKey];
          quotients[maxName] = partyVotes / (mandates[maxName] + 1);
        }

        const final = data.map(p=>{
          const votes=p[voteKey], percent=totalVotes?(votes/totalVotes)*100:0;
          const qualified = votes>=threshold;
          return {
            ...p, votes, percent, qualified,
            mandates: qualified?(mandates[p.name]||0):0,
            color: qualified?(PARTY_COLORS[p.name]||'#374151'):'#D1D5DB'
          };
        });
        final.sort((a,b)=> (b.mandates-a.mandates) || (b.votes-a.votes));
        return final;
      };

      const dhondtStepsDetailed = (data, voteKey, steps, totalVotes) => {
        const threshold = totalVotes * 0.05;
        const parties = data
          .filter(p => p[voteKey] >= threshold)
          .map(p => ({ name: p.name, votes: p[voteKey], mandates: 0, color: PARTY_COLORS[p.name] || '#999' }));
        const timeline = [];
        if (!parties.length) return { qualifying: [], timeline: [] };

        for (let s=1; s<=steps; s++){
          const current = parties.map(p => ({
            name: p.name,
            q: p.votes / (p.mandates + 1),
            divisor: p.mandates + 1,
            color: p.color
          }));
          const winner = current.reduce((a,b)=> a.q>=b.q ? a : b);
          timeline.push({
            step: s,
            rows: current
              .sort((a,b)=> b.q - a.q)
              .map(r => ({ ...r, win: r.name === winner.name }))
          });
          parties.find(p=>p.name===winner.name).mandates++;
        }
        return { qualifying: parties.map(p=>({name:p.name, votes:p.votes, color:p.color})), timeline };
      };

      const Loader = () => (
        <div className="flex justify-center items-center py-8">
          <div className="animate-spin rounded-full h-8 w-8 border-2 border-gray-200 border-t-blue-500"></div>
          <p className="ml-3 text-gray-600">Probíhá výpočet…</p>
        </div>
      );

      const PieChartView = ({ data, totalVotes }) => {
        const chartData = data.filter(p=>p.votes>0).map(p=>({
          name:p.name, value:p.votes, color:p.color, percent:p.percent
        }));
        return (
          <div className="flex flex-col items-center">
            <h3 className="text-xl font-semibold mb-4">Koláčový graf hlasů</h3>
            <ResponsiveContainer width="100%" height={400}>
              <PieChart>
                <Pie data={chartData} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={150} labelLine={false}
                     label={({name})=>name}>
                  {chartData.map((e,i)=><Cell key={i} fill={e.color}/>)}
                </Pie>
                <Tooltip formatter={(value,_n,{payload})=>[
                  `${value} hlasů · ${payload.percent.toFixed(2)} %`, payload.name
                ]}/>
                <Legend layout="horizontal" verticalAlign="bottom" align="center" />
              </PieChart>
            </ResponsiveContainer>
            <p className="text-sm text-gray-600 mt-2">Celkem platných hlasů: <strong>{totalVotes}</strong>.</p>
          </div>
        );
      };

      const BarChartView = ({ data }) => {
        const chartData = data.map(p => {
          const color = p.color;
          return {
            name: p.name,
            Hlasy: p.votes,
            Mandáty: p.mandates,
            color,
            light: mixWithWhite(color, 0.65)
          };
        });
        return (
          <div className="flex flex-col items-center">
            <h3 className="text-xl font-semibold mb-4">Sloupcový graf hlasů a mandátů</h3>
            <ResponsiveContainer width="100%" height={420}>
              <BarChart data={chartData} margin={{ top: 20, right: 30, left: 20, bottom: 5 }}>
                <CartesianGrid strokeDasharray="3 3" />
                <XAxis dataKey="name" angle={-30} textAnchor="end" height={60} />
                <YAxis />
                <Tooltip />
                <Legend />
                <Bar dataKey="Hlasy" name="Počet hlasů">
                  {chartData.map((entry, index) => (
                    <Cell key={`h-${index}`} fill={entry.color} />
                  ))}
                </Bar>
                <Bar dataKey="Mandáty" name="Počet mandátů">
                  {chartData.map((entry, index) => (
                    <Cell key={`m-${index}`} fill={entry.light} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
        );
      };

      // === FLEXIBILNÍ MŘÍŽKA S KONSTANTNÍMI KOSTIČKAMI (default 0.5 mm) ===
      function SeatGrid({ tiles, caption, legend, seatMm = 0.5, gapPx = 2 }) {
        // doplníme do 200
        const filled = [...tiles];
        while (filled.length < 200) filled.push({ name: '—', color: '#E5E7EB', empty: true });

        const size = `calc(${seatMm}mm)`;

        return (
          <div className="w-full">
            {caption && <h3 className="text-xl font-semibold mb-3">{caption}</h3>}
            <div className="bg-white rounded-lg shadow p-3">
              <div
                className="flex flex-wrap"
                style={{ gap: `${gapPx}px` }}
              >
                {filled.map((t, i) => {
                  const is101 = i === 100; // 101. (1-based)
                  return (
                    <div
                      key={i}
                      className={`rounded-[3px] shadow-sm ${is101 ? 'ring-2 ring-yellow-400 ring-offset-1' : ''}`}
                      title={t.empty ? 'neobsazeno' : `${t.name} – mandát ${i+1}`}
                      style={{
                        width: size,
                        height: size,
                        backgroundColor: t.color,
                        flex: '0 0 auto'
                      }}
                    />
                  );
                })}
              </div>
              <p className="text-xs text-gray-500 mt-2">Zvýrazněno: 101. křeslo. Počet kostiček na řádku se přizpůsobí šířce okna.</p>
            </div>

            {legend && (
              <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 w-full">
                {legend.map(p => (
                  <div key={p.name} className="flex items-center gap-2">
                    <span className="inline-block w-3 h-3 rounded" style={{ backgroundColor: p.color }}></span>
                    <span className="text-sm">{p.name}</span>
                    {'mandates' in p && <span className="ml-auto text-sm font-semibold">{p.mandates}</span>}
                  </div>
                ))}
              </div>
            )}
          </div>
        );
      }

      const MandatesGridView = ({ data }) => {
        const ordered = data.filter(p=>p.mandates>0).sort((a,b)=> b.mandates - a.mandates || b.votes - a.votes);
        const tiles = ordered.flatMap(p => Array.from({length:p.mandates}).map(()=>({name:p.name, color:p.color})));
        const legend = ordered.map(p => ({name:p.name, color:p.color, mandates:p.mandates}));
        return <SeatGrid tiles={tiles} caption="Rozdělení mandátů" legend={legend} seatMm={0.5} />;
      };

      function ResultsTable({ data, totalVotes, threshold }) {
        const mandatesSum = data.reduce((s,p)=>s+p.mandates,0);
        return (
          <div className="overflow-x-auto">
            <h3 className="text-xl font-semibold mb-4 text-center">Tabulka kompletních výsledků</h3>
            <div className="p-4 bg-white rounded-lg shadow-lg">
              <table className="min-w-full divide-y divide-gray-200">
                <thead className="bg-gray-50">
                  <tr>
                    <th className="px-6 py-3 text-left  text-xs font-medium text-gray-500 uppercase tracking-wider">Strana</th>
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Hlasy</th>
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Podíl %</th>
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">5% Klauzule</th>
                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Mandáty</th>
                  </tr>
                </thead>
                <tbody className="bg-white divide-y divide-gray-200">
                  {data.map((p,i)=>(
                    <tr key={i} className={p.qualified?'hover:bg-green-50':'hover:bg-red-50'}>
                      <td className="px-6 py-4 whitespace-nowrap text-sm font-medium" style={{color:p.color}}>{p.name}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-right">{p.votes}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-right">{p.percent.toFixed(2)}</td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm text-right">
                        <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p.qualified?'bg-green-100 text-green-800':'bg-red-100 text-red-800'}`}>
                          {p.qualified?'Postupuje':'Eliminována'}
                        </span>
                      </td>
                      <td className="px-6 py-4 whitespace-nowrap text-sm font-bold text-right">{p.mandates}</td>
                    </tr>
                  ))}
                  <tr>
                    <td className="px-6 py-4 font-bold">CELKEM</td>
                    <td className="px-6 py-4 font-bold text-right">{totalVotes}</td>
                    <td className="px-6 py-4 font-bold text-right">100.00</td>
                    <td className="px-6 py-4 font-bold text-right">Kvórum: {threshold.toFixed(2)}</td>
                    <td className="px-6 py-4 font-bold text-right">{mandatesSum}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        );
      }

      const ExplanationModal = ({ onClose, mode, totalVotes, threshold, data }) => {
        const voteKey = mode==='student' ? 'student' : 'total';
        const { qualifying, timeline } = dhondtStepsDetailed(data, voteKey, 10, totalVotes);

        return (
          <div className="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 p-4">
            <div className="bg-white rounded-xl shadow-2xl max-w-4xl w-full p-6 md:p-10 relative max-h-[90vh] overflow-y-auto">
              <button onClick={onClose} className="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-2xl font-bold" aria-label="Zavřít">&times;</button>
              <h2 className="text-2xl font-extrabold mb-4 text-blue-700">Jak se přepočítávají hlasy na mandáty – D'Hondt</h2>

              <div className="grid md:grid-cols-2 gap-4 mb-6">
                <div className="bg-blue-50 p-3 rounded-lg border border-blue-200">
                  <p className="font-mono text-sm">Platné hlasy: <strong>{totalVotes}</strong></p>
                  <p className="font-mono text-sm">Limit 5 %: <strong>{threshold.toFixed(2)} hlasů</strong></p>
                </div>
                <div className="bg-green-50 p-3 rounded-lg border border-green-200">
                  <p className="font-semibold mb-1">Postupující strany</p>
                  {qualifying.length
                    ? <ul className="list-disc pl-5 text-sm">
                        {qualifying.map(q=>(
                          <li key={q.name}><span className="font-medium" style={{color:q.color}}>{q.name}</span>: {q.votes} hlasů</li>
                        ))}
                      </ul>
                    : <p className="text-sm">Žádná strana nepřekročila 5 %</p>}
                </div>
              </div>

              <h3 className="text-xl font-bold mt-2 mb-2">Princip metody</h3>
              <ol className="list-decimal pl-6 space-y-1 text-sm">
                <li>Do dělení jdou jen strany nad 5 %.</li>
                <li>Kvocient: hlasy / (už získané mandáty + 1).</li>
                <li>V každém kroku mandát získá strana s nejvyšším kvocientem.</li>
                <li>Po přidělení mandátu této straně zvýšíme dělitel o 1 a přepočítáme její kvocient.</li>
                <li>Pokračujeme do rozdělení 200 mandátů.</li>
              </ol>

              <h3 className="text-xl font-bold mt-6 mb-3">Prvních 10 kroků – vizualizace</h3>
              <div className="space-y-3">
                {timeline.map(step => (
                  <div key={step.step} className="bg-gray-50 rounded-lg p-3 border border-gray-200">
                    <div className="text-sm font-semibold mb-2">Krok {step.step}</div>
                    <div className="flex flex-wrap gap-2">
                      {step.rows.map(r => (
                        <span key={r.name}
                          className={`px-2 py-1 rounded-lg text-xs font-medium border ${r.win ? 'ring-2 ring-offset-2' : ''}`}
                          style={{
                            backgroundColor: mixWithWhite(r.color, 0.85),
                            borderColor: r.win ? r.color : mixWithWhite('#000', 0.9),
                            color: '#111',
                          }}
                          title={`dělitel ${r.divisor}`}
                        >
                          <span className="mr-1" style={{color:r.color}}>●</span>
                          {r.name} • {r.q.toFixed(3)}
                          {r.win && <span className="ml-1 font-bold" style={{color:r.color}}>— mandát</span>}
                        </span>
                      ))}
                    </div>
                  </div>
                ))}
              </div>

              <p className="text-sm text-gray-600 mt-4">Pozn.: Ukázka je ilustrační. Finální rozdělení vzniká po 200 krocích stejného postupu.</p>
            </div>
          </div>
        );
      };

      const CoalitionBuilder = ({ parties }) => {
        const eligible = parties.filter(p=>p.mandates>0);
        const [selected, setSelected] = useState(new Set());

        const toggle = (name) => {
          const s = new Set(selected);
          s.has(name) ? s.delete(name) : s.add(name);
          setSelected(s);
        };
        const selectTop = (n) => setSelected(new Set(eligible.slice(0,n).map(p=>p.name)));
        const clearAll = () => setSelected(new Set());
        const selectAll = () => setSelected(new Set(eligible.map(p=>p.name)));

        const selectedList = eligible.filter(p=>selected.has(p.name))
          .sort((a,b)=> b.mandates - a.mandates || b.votes - a.votes);
        const mandates = selectedList.reduce((sum,p)=>sum+p.mandates,0);
        const majority = mandates >= 101;

        const tilesSel = selectedList.flatMap(p => Array.from({length:p.mandates}).map(()=>({name:p.name, color:p.color})));

        return (
          <div className="space-y-4">
            <div className={`p-4 rounded-lg ${majority ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'}`}>
              <div className="flex items-baseline gap-3">
                <span className="text-2xl font-extrabold">{mandates}</span>
                <span className="text-gray-600">/ 200 mandátů</span>
                <span className={`ml-auto px-2 py-1 rounded-full text-sm font-semibold ${majority?'bg-green-200 text-green-800':'bg-red-200 text-red-800'}`}>
                  {majority ? 'Má většinu (≥ 101)' : 'Bez většiny (< 101)'}
                </span>
              </div>
              <p className="text-sm text-gray-500 mt-1">Zvýrazněno: 101. křeslo.</p>
            </div>

            <div className="flex flex-wrap gap-2">
              {eligible.map(p=>(
                <button key={p.name}
                  onClick={()=>toggle(p.name)}
                  className={`px-3 py-1 rounded-full text-sm border shadow-sm transition ${selected.has(p.name) ? 'ring-2 ring-offset-2' : ''}`}
                  style={{ backgroundColor: mixWithWhite(p.color, selected.has(p.name) ? 0.75 : 0.9), borderColor: p.color, color:'#111' }}>
                  <span className="mr-1" style={{color:p.color}}>●</span>{p.name} <span className="opacity-70">• {p.mandates}</span>
                </button>
              ))}
            </div>

            <div className="flex flex-wrap gap-2">
              <button className="px-3 py-1 rounded-lg bg-white border hover:bg-gray-50" onClick={clearAll}>Vyčistit</button>
              <button className="px-3 py-1 rounded-lg bg-white border hover:bg-gray-50" onClick={()=>selectTop(2)}>Top 2</button>
              <button className="px-3 py-1 rounded-lg bg-white border hover:bg-gray-50" onClick={()=>selectTop(3)}>Top 3</button>
              <button className="px-3 py-1 rounded-lg bg-white border hover:bg-gray-50" onClick={()=>selectTop(4)}>Top 4</button>
              <button className="px-3 py-1 rounded-lg bg-white border hover:bg-gray-50" onClick={selectAll}>Vybrat všechny</button>
            </div>

            <SeatGrid
              tiles={tilesSel}
              caption="Koaliční mandáty"
              legend={selectedList.map(p=>({name:p.name, color:p.color, mandates:p.mandates}))}
              seatMm={0.5}
            />
          </div>
        );
      };

      const App = () => {
        const [mode, setMode] = useState('student');
        const [view, setView] = useState('pie');  // 'pie' | 'bar' | 'mandates' | 'table' | 'coalition'
        const [showExplanation, setShowExplanation] = useState(false);

        const voteKey = mode==='student' ? 'student' : 'total';
        const totalVotes = votesCast[voteKey];
        const electorate = (voteKey==='student') ? totalElectorate.student : totalElectorate.total;

        const results = useMemo(()=>calculateMandates(initialData, totalVotes, 200, voteKey), [mode, totalVotes]);
        const turnout = electorate ? (votesCast[voteKey]/electorate)*100 : 0;
        const threshold = totalVotes * 0.05;

        const p4Votes = initialData.reduce((s,p)=>s+p.p4,0);

        const getTurnoutInfo = () => mode==='student'
          ? (<div className="text-sm">
              <p>Hlasujících studentů: <strong>{votesCast.student}</strong> / {totalElectorate.student}</p>
              <p className="font-semibold text-blue-600">Účast: {turnout.toFixed(2)} %</p>
              <p className="mt-2 italic text-gray-700">Z toho <strong>{p4Votes}</strong> hlasů čtvrťáků v režimu „ze zahraničí“.</p>
            </div>)
          : (<div className="text-sm">
              <p>Hlasujících celkem: <strong>{votesCast.total}</strong> / {totalElectorate.total}</p>
              <p className="font-semibold text-blue-600">Účast: {turnout.toFixed(2)} %</p>
            </div>);

        const renderVisualization = () => {
          if (!results.length) return <Loader />;
          if (view==='pie')
            return <div className="flex flex-col md:flex-row gap-8">
              <div className="w-full md:w-1/2"><PieChartView data={results} totalVotes={totalVotes}/></div>
              <div className="w-full md:w-1/2"><MandatesGridView data={results}/></div>
            </div>;
          if (view==='bar') return <BarChartView data={results}/>;
          if (view==='table') return <ResultsTable data={results} totalVotes={totalVotes} threshold={threshold}/>;
          if (view==='mandates') return <MandatesGridView data={results}/>;
          if (view==='coalition') return <CoalitionBuilder parties={results}/>;
          return null;
        };

        return (
          <div className="bg-white shadow-xl rounded-2xl p-4 md:p-8">
            <h1 className="text-3xl md:text-4xl font-extrabold text-gray-800 mb-6 border-b pb-3">Školní Volební Analýza</h1>
            <p className="text-lg text-gray-600 mb-6">Interaktivní vizualizace a přepočet mandátů podle pravidel pro Poslaneckou sněmovnu.</p>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
              <div className="p-4 bg-gray-100 rounded-lg shadow-inner col-span-1 md:col-span-2">
                <h2 className="text-xl font-bold mb-3">Režim hlasování</h2>
                <div className="flex flex-wrap gap-3">
                  <button onClick={()=>setMode('student')}
                          className={`px-6 py-2 rounded-full font-semibold transition ${mode==='student'?'bg-blue-600 text-white hover:bg-blue-700':'bg-white text-blue-600 border border-blue-600 hover:bg-blue-50'}`}>
                    Pouze studenti
                  </button>
                  <button onClick={()=>setMode('total')}
                          className={`px-6 py-2 rounded-full font-semibold transition ${mode==='total'?'bg-blue-600 text-white hover:bg-blue-700':'bg-white text-blue-600 border border-blue-600 hover:bg-blue-50'}`}>
                    Studenti + Učitelé
                  </button>
                </div>
              </div>
              <div className="p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg shadow-inner">
                <h2 className="text-xl font-bold mb-2">Volební účast</h2>
                {getTurnoutInfo()}
              </div>
            </div>

            <div className="mb-8 border-t pt-4">
              <h2 className="text-xl font-bold mb-3">Zobrazení výsledků</h2>
              <div className="flex flex-wrap gap-3">
                <button onClick={()=>setView('pie')}       className={`px-4 py-2 rounded-lg font-medium transition ${view==='pie'?'bg-green-500 text-white shadow-lg':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>Koláčový graf</button>
                <button onClick={()=>setView('bar')}       className={`px-4 py-2 rounded-lg font-medium transition ${view==='bar'?'bg-green-500 text-white shadow-lg':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>Sloupcový graf</button>
                <button onClick={()=>setView('table')}     className={`px-4 py-2 rounded-lg font-medium transition ${view==='table'?'bg-green-500 text-white shadow-lg':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>Tabulka</button>
                <button onClick={()=>setView('mandates')}  className={`px-4 py-2 rounded-lg font-medium transition ${view==='mandates'?'bg-green-500 text-white shadow-lg':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>Mřížka mandátů</button>
                <button onClick={()=>setView('coalition')} className={`px-4 py-2 rounded-lg font-medium transition ${view==='coalition'?'bg-purple-500 text-white shadow-lg':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}>Sestav koalici</button>
                <button onClick={()=>setShowExplanation(true)} className="px-4 py-2 rounded-lg font-medium transition bg-blue-500 text-white hover:bg-blue-600 shadow-md">Vysvětlení přepočtu</button>
              </div>
            </div>

            <div className="min-h-[500px] border-t pt-8">
              {renderVisualization()}
            </div>

            {showExplanation && (
              <ExplanationModal
                onClose={()=>setShowExplanation(false)}
                mode={mode}
                totalVotes={totalVotes}
                threshold={threshold}
                data={initialData}
              />
            )}
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    });
  </script>
</body>
</html>
