<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Školní volby – přepočet mandátů (d’Hondt)</title>
  <!-- Pouze runtime React/ReactDOM z CDN – bez dalších závislostí/bundleru -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    :root{
      --bg:#0f172a;        /* slate-900 */
      --panel:#111827;     /* gray-900 */
      --muted:#9ca3af;     /* gray-400 */
      --text:#e5e7eb;      /* gray-200 */
      --acc:#60a5fa;       /* blue-400 */
      --acc2:#34d399;      /* emerald-400 */
      --danger:#f87171;    /* red-400 */
      --seat:#a78bfa;      /* violet-400 */
      --chip:#1f2937;      /* gray-800 */
      --border:#1f2937;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      color:var(--text); background:linear-gradient(180deg,#0b1224, #0f172a 40%);
    }
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
    h1{font-size:clamp(22px,3vw,30px);margin:0 0 12px}
    .sub{color:var(--muted);margin-bottom:20px}
    .panel{
      background:rgba(17,24,39,.75); backdrop-filter: blur(6px);
      border:1px solid var(--border); border-radius:16px; padding:16px; margin-bottom:16px;
      box-shadow:0 8px 24px rgba(0,0,0,.35);
    }
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 280px}
    .controls label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type="number"], input[type="text"], select{
      width:100%; background:#0b1020; color:var(--text);
      border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none;
    }
    input[type="number"]::-webkit-outer-spin-button, input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }
    .seg{display:flex;gap:8px;flex-wrap:wrap}
    .seg button{
      background:var(--chip); color:var(--text); border:1px solid var(--border);
      padding:8px 12px; border-radius:999px; cursor:pointer;
    }
    .seg button.active{background:var(--acc);border-color:transparent}
    .btn{
      background:var(--acc); color:#0b1020; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600;
    }
    .btn.link{background:transparent;color:var(--acc);border:1px solid var(--acc)}
    .btn.secondary{background:var(--chip);color:var(--text)}
    .table{width:100%;border-collapse:collapse;font-size:14px}
    .table th,.table td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left}
    .tag{display:inline-flex;align-items:center;gap:8px;background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:6px 10px;margin:4px 6px 0 0}
    .tag b{font-variant-numeric: tabular-nums}
    .muted{color:var(--muted)}
    .warn{color:var(--danger)}
    .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .legend .sw{width:12px;height:12px;border-radius:3px;display:inline-block;margin-right:6px;vertical-align:middle;border:1px solid #0003}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:50}
    .modal{background:var(--panel);border:1px solid var(--border);border-radius:16px;max-width:1000px;width:92vw;max-height:86vh;overflow:auto;padding:16px}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;background:#0b1020;border:1px solid var(--border);border-radius:8px;padding:2px 6px}
    .note{font-size:13px;color:var(--muted)}
    .hr{height:1px;background:var(--border);margin:10px 0}
    .cards{display:flex;gap:12px;flex-wrap:wrap}
    .card{flex:1 1 260px;border:1px solid var(--border);border-radius:14px;padding:12px;background:#0b1020}
    .seat{width:10px;height:10px;border-radius:50%;margin:1px;display:inline-block}
    .grid-seats{display:flex;flex-wrap:wrap;gap:2px}
    .foot{margin-top:8px;color:var(--muted);font-size:12px}
    .small{font-size:12px}
    .pill{display:inline-flex;gap:6px;align-items:center;background:#0b1020;border:1px solid var(--border);border-radius:999px;padding:4px 8px;color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <h1>Školní volby – přepočet na mandáty (d’Hondt, 5%)</h1>
  <div class="sub">Interaktivní aplikace pro středoškoláky. Můžeš upravit vstupy, zvolit typ grafu a otevřít detailní vysvětlení výpočtu.</div>

  <div id="app"></div>
</div>

<script>
const { useMemo, useState } = React;

// --- VSTUPNÍ DATA (podle obrázku)
const RAW = [
  {name:"Spolu",     students:26, teachers:4, color:"#60a5fa"},
  {name:"SPD",       students:1,  teachers:0, color:"#fb7185"},
  {name:"Motoristé", students:5,  teachers:1, color:"#f59e0b"},
  {name:"MZH",       students:1,  teachers:0, color:"#34d399"},
  {name:"Generace",  students:1,  teachers:0, color:"#a78bfa"},
  {name:"Levice",    students:1,  teachers:0, color:"#f472b6"},
  {name:"SMS",       students:1,  teachers:0, color:"#22d3ee"},
  {name:"Přísaha",   students:1,  teachers:0, color:"#f97316"},
  {name:"Voluntia",  students:3,  teachers:0, color:"#84cc16"},
  {name:"Ano",       students:2,  teachers:0, color:"#93c5fd"},
  {name:"Rebelové",  students:3,  teachers:0, color:"#fca5a5"},
  {name:"Koruna",    students:1,  teachers:1, color:"#67e8f9"},
  {name:"STAN",      students:35, teachers:4, color:"#34d399"},
  {name:"Piráti",    students:24, teachers:1, color:"#a3e635"},
];

// Pomocná utilita
const sum = arr => arr.reduce((a,b)=>a+b,0);
const formatPct = x => (x*100).toFixed(2).replace(".",",")+" %";

// d’Hondt výpočet s 5% klauzulí
function dhondtAllocate(parties, seats=200, thresholdPct=0.05){
  const total = sum(parties.map(p=>p.votes));
  const eligible = parties.filter(p => total>0 ? (p.votes/total)>=thresholdPct : false);
  // Pokud nikdo nepřekročí 5 %, bereme všechno (aby appka nepadla) – školní režim
  const list = eligible.length? eligible : parties;

  // Generujeme kvocienty
  const quotients = [];
  list.forEach(p=>{
    for(let d=1; d<=seats; d++){
      quotients.push({party:p.name, value:p.votes/d, divisor:d});
    }
  });
  // Top-N kvocientů
  quotients.sort((a,b)=>b.value - a.value);
  const cut = quotients.slice(0, seats);

  // Sčítání mandátů
  const seatMap = Object.fromEntries(list.map(p=>[p.name,0]));
  cut.forEach(q=> seatMap[q.party]++ );

  return {
    totalVotes: total,
    participating: list.map(p=>p.name),
    seatsByParty: seatMap,
    quotients: cut, // zobrazení v modálu
    thresholdApplied: eligible.length>0,
  };
}

// SVG GRAFY -------------------------------------------------
function BarChart({data, valueKey="value", labelKey="name", colors, height=260, padding=28}){
  const w = 920;
  const max = Math.max(...data.map(d=>d[valueKey]), 1);
  const barW = (w - padding*2) / data.length;
  return React.createElement('svg',{viewBox:`0 0 ${w} ${height}`,width:"100%",height},
    // osy
    React.createElement('line',{x1:padding,y1:height-24,x2:w-padding,y2:height-24,stroke:"#334155",strokeWidth:1}),
    data.map((d,i)=>{
      const h = (height-60) * (d[valueKey]/max);
      const x = padding + i*barW + 6;
      const y = height-26 - h;
      return React.createElement(React.Fragment,{key:i},
        React.createElement('rect',{x,y,width:barW-12,height:h,fill:colors[d[labelKey]]||"#60a5fa"}),
        React.createElement('text',{x:x+(barW-12)/2,y:height-8,fill:"#cbd5e1",fontSize:12,textAnchor:"middle"}, d[labelKey]),
        React.createElement('text',{x:x+(barW-12)/2,y:y-4,fill:"#e5e7eb",fontSize:12,textAnchor:"middle"},
          typeof d[valueKey]==='number' ? d[valueKey].toFixed(0) : d[valueKey])
      );
    })
  );
}

function PieChart({data, valueKey="value", labelKey="name", colors, radius=120}){
  const total = data.reduce((a,b)=>a + (b[valueKey]||0),0) || 1;
  let angle = -Math.PI/2;
  const cx=160, cy=160;
  const arcs = data.map((d,i)=>{
    const slice = 2*Math.PI*(d[valueKey]/total);
    const x1 = cx + radius*Math.cos(angle);
    const y1 = cy + radius*Math.sin(angle);
    angle += slice;
    const x2 = cx + radius*Math.cos(angle);
    const y2 = cy + radius*Math.sin(angle);
    const largeArc = slice > Math.PI ? 1:0;
    const path = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2} Z`;
    return {path, name:d[labelKey], value:d[valueKey]};
  });
  return React.createElement('div',{style:{display:"flex",gap:"16px",alignItems:"center",flexWrap:"wrap"}},
    React.createElement('svg',{viewBox:"0 0 320 320",width:320,height:320},
      arcs.map((a,i)=>React.createElement('path',{key:i,d:a.path,fill:colors[a.name]||"#60a5fa",stroke:"#0b1020",strokeWidth:1}))
    ),
    React.createElement('div',null,
      data.map((d,i)=>React.createElement('div',{key:i,className:"tag"},
        React.createElement('span',{className:"sw",style:{background:colors[d[labelKey]]||"#60a5fa"}}),
        React.createElement('span',null,d[labelKey]),
        React.createElement('b',null, typeof d[valueKey]==='number' ? d[valueKey].toFixed(2) : d[valueKey])
      ))
    )
  );
}

function SeatChart({seatsByParty, colors, totalSeats=200}){
  // poloválcové uspořádání 200 "křesel"
  const seats = [];
  Object.entries(seatsByParty).forEach(([name, n])=>{
    for(let i=0;i<n;i++) seats.push(name);
  });
  // doplň prázdná místa (když nikdo neprošel)
  while(seats.length<totalSeats) seats.push("_");
  const cols = 25; // 8 řad po ~25
  return React.createElement('div',null,
    React.createElement('div',{className:"grid-seats"},
      seats.map((p,i)=>React.createElement('span',{
        key:i,className:"seat",
        style:{background: p==="_" ? "#334155" : (colors[p]||"#60a5fa")}
      }))
    ),
    React.createElement('div',{className:"legend"},
      Object.entries(seatsByParty).map(([name,val])=>
        React.createElement('div',{key:name,className:"tag"},
          React.createElement('span',{className:"sw",style:{background:colors[name]||"#60a5fa"}}),
          React.createElement('span',null,`${name}`),
          React.createElement('b',null,`${val}`)
        )
      )
    )
  );
}

// VYSVĚTLENÍ – MODÁL
function Modal({open,onClose,children,title}){
  if(!open) return null;
  return React.createElement('div',{className:"modal-backdrop",onClick:onClose},
    React.createElement('div',{className:"modal",onClick:e=>e.stopPropagation()},
      React.createElement('div',{className:"row",style:{alignItems:"center",marginBottom:6}},
        React.createElement('h2',{style:{margin:"0 8px 0 0"}}, title || "Vysvětlení"),
        React.createElement('span',{className:"pill"}, "Metoda d’Hondt · 5% klauzule"),
        React.createElement('div',{style:{flex:1}}),
        React.createElement('button',{className:"btn secondary",onClick:onClose},"Zavřít")
      ),
      children
    )
  );
}

// HLAVNÍ APLIKACE
function App(){
  const [mode, setMode] = useState("students"); // students | both
  const [metric, setMetric] = useState("percent"); // percent | seats | turnout
  const [chart, setChart] = useState("bars"); // bars | pie | seats
  const [seatCount, setSeatCount] = useState(200);
  const [threshold, setThreshold] = useState(5);
  const [multS, setMultS] = useState(1);
  const [multT, setMultT] = useState(1);
  // Účast – výchozí hodnoty z obrázku; lze upravit
  const [eligibleS, setEligibleS] = useState(182); // hlasující celkem (žáci) – můžeš změnit na "oprávněných"
  const [votedS, setVotedS] = useState(182);
  const [eligibleT, setEligibleT] = useState(11);
  const [votedT, setVotedT] = useState(11);

  const colors = Object.fromEntries(RAW.map(p=>[p.name, p.color || "#60a5fa"]));

  const dataset = useMemo(()=>{
    // postav hlasové vstupy podle režimu
    return RAW.map(p=>{
      const s = p.students * multS;
      const t = p.teachers * multT;
      return {
        name:p.name,
        votes: mode==="students" ? s : (s+t),
        baseStudents: p.students,
        baseTeachers: p.teachers
      };
    });
  }, [mode, multS, multT]);

  const totals = useMemo(()=>{
    const totalVotes = sum(dataset.map(p=>p.votes));
    const percents = dataset.map(p=>({
      name:p.name,
      value: totalVotes? (p.votes/totalVotes*100):0
    }));
    const dh = dhondtAllocate(dataset, seatCount, threshold/100);
    return { totalVotes, percents, dh };
  }, [dataset, seatCount, threshold]);

  const percentData = totals.percents
      .sort((a,b)=>b.value-a.value)
      .map(d=>({name:d.name, value:+d.value.toFixed(2)}));

  const seatData = Object.entries(totals.dh.seatsByParty)
      .sort((a,b)=>b[1]-a[1])
      .map(([name,v])=>({name, value:v}));

  const turnout = useMemo(()=>{
    const eligible = (mode==="students"? eligibleS : eligibleS+eligibleT);
    const voted    = (mode==="students"? votedS    : votedS+votedT);
    const pct = eligible>0 ? (voted/eligible*100) : 0;
    return {eligible, voted, pct};
  }, [mode, eligibleS, eligibleT, votedS, votedT]);

  // obsah grafu
  function chartNode(){
    const current = metric==="percent"? percentData : (metric==="seats"? seatData : [{name:"Účast", value: turnout.pct}]);
    if(chart==="bars"){
      return React.createElement(BarChart,{
        data: current, valueKey:"value", labelKey:"name", colors
      });
    }
    if(chart==="pie"){
      return React.createElement(PieChart,{
        data: current, valueKey:"value", labelKey:"name", colors
      });
    }
    return React.createElement(SeatChart,{seatsByParty: totals.dh.seatsByParty, colors, totalSeats: seatCount});
  }

  // MODÁL – vysvětlení d’Hondta
  const [open, setOpen] = useState(false);

  return React.createElement(React.Fragment,null,
    React.createElement('div',{className:"panel"},
      React.createElement('div',{className:"row"},
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Režim dat"),
          React.createElement('div',{className:"seg"},
            React.createElement('button',{className: mode==="students"?"active":"", onClick:()=>setMode("students")},"Jen žáci"),
            React.createElement('button',{className: mode==="both"?"active":"", onClick:()=>setMode("both")},"Žáci + učitelé"),
            React.createElement('span',{className:"pill"}, `Celkem hlasů: ${totals.totalVotes}`)
          )
        ),
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Zobrazená metrika"),
          React.createElement('div',{className:"seg"},
            React.createElement('button',{className: metric==="percent"?"active":"", onClick:()=>setMetric("percent")},"A) Procenta"),
            React.createElement('button',{className: metric==="seats"?"active":"", onClick:()=>setMetric("seats")},"B) Mandáty"),
            React.createElement('button',{className: metric==="turnout"?"active":"", onClick:()=>setMetric("turnout")},"C) Účast")
          )
        ),
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Typ grafu"),
          React.createElement('div',{className:"seg"},
            React.createElement('button',{className: chart==="bars"?"active":"", onClick:()=>setChart("bars")},"Sloupce"),
            React.createElement('button',{className: chart==="pie"?"active":"", onClick:()=>setChart("pie")},"Koláč"),
            React.createElement('button',{className: chart==="seats"?"active":"", onClick:()=>setChart("seats")},"Křesla")
          )
        )
      ),
      React.createElement('div',{className:"row"},
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Počet mandátů"),
          React.createElement('input',{type:"number",min:1,max:500,value:seatCount,onChange:e=>setSeatCount(+e.target.value || 0)})
        ),
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Práh pro vstup (5% v ČR)"),
          React.createElement('input',{type:"number",min:0,max:10,step:"0.1",value:threshold,onChange:e=>setThreshold(+e.target.value)})
        ),
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Multiplikátor hlasů (škálování)"),
          React.createElement('div',{className:"row"},
            React.createElement('div',{className:"col"},
              React.createElement('input',{type:"number",step:"0.1",value:multS,onChange:e=>setMultS(+e.target.value || 0)}),
              React.createElement('div',{className:"small muted"},"× žáci")
            ),
            React.createElement('div',{className:"col"},
              React.createElement('input',{type:"number",step:"0.1",value:multT,onChange:e=>setMultT(+e.target.value || 0)}),
              React.createElement('div',{className:"small muted"},"× učitelé")
            )
          )
        )
      ),
      React.createElement('div',{className:"row"},
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Účast – žáci (oprávnění / hlasovalo)"),
          React.createElement('div',{className:"row"},
            React.createElement('div',{className:"col"},
              React.createElement('input',{type:"number",value:eligibleS,onChange:e=>setEligibleS(+e.target.value||0)}),
              React.createElement('div',{className:"small muted"},"Oprávněných žáků")
            ),
            React.createElement('div',{className:"col"},
              React.createElement('input',{type:"number",value:votedS,onChange:e=>setVotedS(+e.target.value||0)}),
              React.createElement('div',{className:"small muted"},"Hlasovalo žáků")
            )
          )
        ),
        React.createElement('div',{className:"col controls"},
          React.createElement('label',null,"Účast – učitelé (oprávnění / hlasovalo)"),
          React.createElement('div',{className:"row"},
            React.createElement('div',{className:"col"},
              React.createElement('input',{type:"number",value:eligibleT,onChange:e=>setEligibleT(+e.target.value||0)}),
              React.createElement('div',{className:"small muted"},"Oprávněných učitelů")
            ),
            React.createElement('div',{className:"col"},
              React.createElement('input',{type:"number",value:votedT,onChange:e=>setVotedT(+e.target.value||0)}),
              React.createElement('div',{className:"small muted"},"Hlasovalo učitelů")
            )
          )
        ),
        React.createElement('div',{className:"col",style:{display:"flex",alignItems:"flex-end",gap:"8px"}},
          React.createElement('button',{className:"btn",onClick:()=>setOpen(true)},"Jak se počítají mandáty?")
        )
      )
    ),

    React.createElement('div',{className:"panel"}, chartNode()),

    React.createElement('div',{className:"panel"},
      React.createElement('h3',null,"Přehled čísel"),
      React.createElement('div',{className:"cards"},
        React.createElement('div',{className:"card"},
          React.createElement('div',{className:"muted small"},"A) Procenta (z platných hlasů)"),
          React.createElement('table',{className:"table"},
            React.createElement('thead',null,
              React.createElement('tr',null,
                React.createElement('th',null,"Strana"),
                React.createElement('th',null,"Procenta"),
                React.createElement('th',null,"Hlasy")
              )
            ),
            React.createElement('tbody',null,
              percentData.map(r=>React.createElement('tr',{key:r.name},
                React.createElement('td',null,r.name),
                React.createElement('td',null, r.value.toFixed(2).replace(".",",")+" %"),
                React.createElement('td',null, dataset.find(p=>p.name===r.name).votes.toFixed(0))
              ))
            )
          )
        ),
        React.createElement('div',{className:"card"},
          React.createElement('div',{className:"muted small"},"B) Mandáty (d’Hondt, práh "+threshold+"%)"),
          React.createElement('table',{className:"table"},
            React.createElement('thead',null,
              React.createElement('tr',null,
                React.createElement('th',null,"Strana"),
                React.createElement('th',null,"Mandáty")
              )
            ),
            React.createElement('tbody',null,
              seatData.map(r=>React.createElement('tr',{key:r.name},
                React.createElement('td',null,r.name),
                React.createElement('td',null,r.value)
              )),
              seatData.length===0 && React.createElement('tr',null,
                React.createElement('td',{colSpan:2,className:"muted"},"Nikdo nepřekročil práh – zobrazeno 0.")
              )
            )
          ),
          React.createElement('div',{className:"foot"}, `Rozděleno ${sum(seatData.map(x=>x.value))} z ${seatCount} mandátů.`)
        ),
        React.createElement('div',{className:"card"},
          React.createElement('div',{className:"muted small"},"C) Volební účast"),
          React.createElement('div',{style:{fontSize:28,fontWeight:700,marginTop:6}}, formatPct(turnout.pct/100)),
          React.createElement('div',{className:"note"}, `Hlasovalo ${turnout.voted} z ${turnout.eligible} oprávněných (režim: ${mode==="students"?"jen žáci":"žáci + učitelé"}).`)
        )
      )
    ),

    React.createElement(Modal,{open,onClose:()=>setOpen(false),title:"Jak se počítají mandáty (d’Hondt)"},
      React.createElement('p',null,"1) Spočítají se platné hlasy pro každou stranu. 2) Strany pod ", React.createElement('span',{className:"kbd"},"5 %"), " z celkového součtu jsou vyloučeny. 3) U každé zbylé strany se vytvoří řada kvocientů: hlasů / 1, /2, /3, … až do počtu rozdělovaných mandátů. 4) Všech ", seatCount, " nejvyšších kvocientů získá mandát. Počet mandátů strany = kolikrát se objeví v top seznamu."),
      React.createElement('div',{className:"hr"}),
      React.createElement('h4',null,"Tabulka nejvyšších kvocientů"),
      React.createElement('div',{className:"note"},"Zobrazeno prvních 50 ze ", seatCount, " přidělených mandátů (aktuální režim vstupů)."),
      React.createElement('table',{className:"table small"},
        React.createElement('thead',null,React.createElement('tr',null,
          React.createElement('th',null,"Poř."),
          React.createElement('th',null,"Strana"),
          React.createElement('th',null,"Kvocient"),
          React.createElement('th',null,"Dělitel")
        )),
        React.createElement('tbody',null,
          totals.dh.quotients.slice(0,50).map((q,i)=>React.createElement('tr',{key:i},
            React.createElement('td',null,i+1),
            React.createElement('td',null,q.party),
            React.createElement('td',null,q.value.toFixed(4)),
            React.createElement('td',null,"/"+q.divisor)
          ))
        )
      ),
      React.createElement('div',{className:"hr"}),
      React.createElement('div',{className:"note"},"Pozn.: Jednotné násobení všech hlasů (multiplikátory) na rozdělení mandátů nic nemění, protože se násobí jak čitatel, tak kvocienty. V appce slouží hlavně pro didaktickou simulaci.")
    )
  );
}

ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
</script>
</body>
</html>
